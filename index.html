<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllabus Pulse - HSC Study Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            color: black;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .progress-section {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 32rem;
        }

        .progress-card {
            text-align: center;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            width: 100%;
        }

        .progress-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            background: #e5e7eb;
            border-radius: 9999px;
            height: 0.5rem;
            margin-bottom: 1rem;
        }

        .progress-fill {
            background: black;
            height: 0.5rem;
            border-radius: 9999px;
            transition: width 0.5s ease;
        }

        .progress-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .progress-stats {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .hero-tasks-section {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 32rem;
        }

        .hero-tasks {
            display: flex;
            gap: 1rem;
            align-items: stretch;
        }

        .task-card {
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: #f9fafb;
            position: relative;
            flex: 1;
        }

        .task-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .task-name {
            font-size: 1.125rem;
            font-weight: 500;
        }

        .task-tick {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #9ca3af;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .task-tick:hover {
            border-color: black;
        }

        .task-tick.completed {
            border-color: black;
        }

        .task-tick i {
            font-size: 1rem;
            color: black;
        }

        .small {
            padding: 0.5rem;
        }

        .small .task-label {
            font-size: 0.75rem;
        }

        .small .task-name {
            font-size: 0.875rem;
            font-weight: normal;
        }

        .small .task-tick {
            width: 1.25rem;
            height: 1.25rem;
            top: 0.5rem;
            right: 0.5rem;
        }

        .small .task-tick i {
            font-size: 0.875rem;
        }

        .task-name.completed {
            text-decoration: line-through;
            color: #6b7280;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: white;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background: #f3f4f6;
        }

        .btn-primary {
            background: black;
            color: white;
            border-color: black;
        }

        .btn-primary:hover {
            background: #374151;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 1rem;
        }

        .modal {
            background: white;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 28rem;
            padding: 1.5rem;
        }

        .modal-large {
            max-width: 72rem;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            flex-grow: 1;
        }

        .modal-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .form-input:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
        }

        .form-help {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .form-help a {
            color: #2563eb;
            text-decoration: none;
        }

        .form-help a:hover {
            text-decoration: underline;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-flex {
            flex: 1;
        }

        .btn-blue {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .btn-blue:hover {
            background: #1d4ed8;
        }

        .btn-green {
            background: #059669;
            color: white;
            border-color: #059669;
        }

        .btn-green:hover {
            background: #047857;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tabs {
            border-bottom: 1px solid #e5e7eb;
        }

        .tabs-nav {
            display: flex;
            gap: 2rem;
            padding: 0 1.5rem;
            overflow-x: auto;
        }

        .tab-button {
            padding: 1rem 0.5rem;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            font-size: 0.875rem;
            white-space: nowrap;
            cursor: pointer;
            color: #6b7280;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }

        .tab-button.active {
            border-bottom-color: black;
            color: black;
        }

        .tab-button:hover:not(.active) {
            color: #374151;
            border-bottom-color: #d1d5db;
        }

        .modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .paper-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .paper-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        .chapter-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .chapter-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .chapter-item:hover {
            background: #f9fafb;
        }

        .chapter-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #9ca3af;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .chapter-checkbox:hover {
            border-color: black;
        }

        .chapter-checkbox.completed {
            border-color: black;
        }

        .chapter-checkbox i {
            font-size: 0.75rem;
            color: black;
        }

        .chapter-title {
            flex-grow: 1;
            font-size: 0.875rem;
        }

        .chapter-title.completed {
            text-decoration: line-through;
            color: #6b7280;
        }

        .chapter-note-btn {
            padding: 0.25rem;
            color: #9ca3af;
            cursor: pointer;
            transition: color 0.2s;
        }

        .chapter-note-btn:hover {
            color: black;
        }

        .chapter-note {
            margin-left: 2rem;
            margin-top: 0.5rem;
        }

        .chapter-note textarea {
            width: 100%;
            padding: 0.5rem;
            font-size: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            resize: none;
            rows: 2;
        }

        .help-section {
            padding: 1rem;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        .help-title {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .help-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            color: #6b7280;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .schedule-column h4 {
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: #374151;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .task-item:hover {
            background: #f9fafb;
        }

        .task-checkbox {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid #9ca3af;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .task-checkbox:hover {
            border-color: black;
        }

        .task-checkbox.completed {
            border-color: black;
        }

        .task-checkbox i {
            font-size: 1rem;
            color: black;
        }

        .task-content {
            flex-grow: 1;
        }

        .task-name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .task-name.completed {
            text-decoration: line-through;
            color: #6b7280;
        }

        .task-time {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .history-table {
            overflow-x: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }

        .history-table table {
            width: 100%;
            font-size: 0.875rem;
        }

        .history-table th,
        .history-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }

        .history-table th {
            background: #f9fafb;
            font-weight: 500;
            text-align: center;
            min-width: 100px;
        }

        .history-table th:first-child,
        .history-table td:first-child {
            text-align: left;
        }

        .history-table td {
            text-align: center;
        }

        .history-icon {
            font-size: 1.125rem;
        }

        .history-icon.completed {
            color: #059669;
        }

        .history-icon.incomplete {
            color: #d1d5db;
        }

        .hidden {
            display: none !important;
        }

        .animate-scale-in {
            animation: scale-in 0.2s ease-out;
        }

        @keyframes scale-in {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .text-green-600 { color: #059669; }
        .text-red-600 { color: #dc2626; }
        .text-blue-600 { color: #2563eb; }
        .text-gray-400 { color: #9ca3af; }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .progress-section {
                grid-template-columns: 1fr;
            }

            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .modal-large {
                max-width: 95vw;
                margin: 1rem;
            }

            .tabs-nav {
                padding: 0 1rem;
                gap: 1rem;
            }

            .hero-tasks {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Syllabus Pulse</h1>
            <p>Track time left vs chapters done</p>
            <p style="font-size: 0.875rem; color: #6b7280;">15 Sep 2025 — 30 Sep 2026</p>
            
            <!-- Sync Status -->
            <div class="sync-status">
                <i id="syncIcon" class="ri-cloud-line text-gray-400"></i>
                <span id="syncText">Offline mode</span>
            </div>
        </header>

        <!-- Progress Section -->
        <section class="progress-section">
            <!-- Syllabus Progress -->
            <div class="progress-card">
                <div class="progress-number" id="syllabusPercentage">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="syllabusProgressBar"></div>
                </div>
                <div class="progress-label">
                    <div class="progress-stats">Syllabus complete</div>
                    <div id="syllabusStats">0 / 0 chapters</div>
                </div>
            </div>
        </section>

        <!-- Hero Tasks Section -->
        <section class="hero-tasks-section">
            <div class="hero-tasks" id="heroTasks"></div>
        </section>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="openSyllabusEditor()">
                <i class="ri-edit-line"></i>
                Edit Syllabus
            </button>
            <button class="btn" onclick="openScheduleModal()">
                <i class="ri-calendar-line"></i>
                View Schedule
            </button>
            <button class="btn" onclick="openHistoryModal()">
                <i class="ri-history-line"></i>
                View History
            </button>
            <button class="btn" onclick="openSettings()">
                <i class="ri-settings-line"></i>
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Cloud Sync Settings</h3>
                <button onclick="closeSettings()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            
            <div>
                <div class="form-group">
                    <label class="form-label">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" class="form-input" placeholder="ghp_xxxxxxxxxxxx">
                    <div class="form-help">
                        <a href="https://github.com/settings/tokens" target="_blank">Create token here</a> with 'gist' scope
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gist ID (optional)</label>
                    <input type="text" id="gistId" class="form-input" placeholder="Leave empty to create new">
                </div>
                
                <div class="btn-group">
                    <button id="syncFromCloudBtn" class="btn btn-blue btn-flex" onclick="syncFromCloud()">
                        Sync From Cloud
                    </button>
                    <button id="syncToCloudBtn" class="btn btn-green btn-flex" onclick="syncToCloud()">
                        Save to Cloud
                    </button>
                </div>
                
                <div style="font-size: 0.75rem; color: #6b7280; margin-top: 1rem;">
                    <p>• Token is stored locally and never shared</p>
                    <p>• Data syncs automatically after changes</p>
                    <p>• Uses private GitHub Gists (completely free)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Syllabus Editor Modal -->
    <div id="syllabusModal" class="modal-overlay hidden">
        <div class="modal modal-large">
            <!-- Modal Header -->
            <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                <h3>Edit Your Progress</h3>
                <div class="modal-actions">
                    <button id="syncButton" class="btn btn-blue" onclick="syncToCloud()" style="display: none;">
                        <i class="ri-cloud-line"></i>
                        Sync
                    </button>
                    <button class="btn" onclick="exportData('csv')">
                        <i class="ri-download-line"></i>
                        Export
                    </button>
                    <button class="btn" onclick="resetChapters()">
                        <i class="ri-refresh-line"></i>
                        Reset
                    </button>
                    <button class="btn" onclick="toggleHelp()">
                        <i class="ri-question-line"></i>
                        Help
                    </button>
                    <button onclick="closeSyllabusEditor()">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
            </div>

            <!-- Help Section -->
            <div id="helpSection" class="help-section hidden">
                <div class="help-title">Keyboard Shortcuts:</div>
                <ul class="help-list">
                    <li>• Space: Toggle chapter when focused</li>
                    <li>• Ctrl+S: Sync to cloud</li>
                    <li>• Ctrl+E: Export CSV</li>
                    <li>• Ctrl+R: Reset all progress</li>
                    <li>• Escape: Close editor</li>
                </ul>
            </div>

            <!-- Subject Tabs -->
            <div class="tabs">
                <nav class="tabs-nav" id="subjectTabs"></nav>
            </div>

            <!-- Modal Content -->
            <div class="modal-content">
                <div class="chapters-grid" id="chaptersGrid"></div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal-overlay hidden">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>Today's Schedule</h3>
                <button onclick="closeScheduleModal()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="schedule-grid" id="modalScheduleGrid">
                    <!-- Morning Schedule -->
                    <div id="modalMorningSchedule">
                        <h4>Classes & Coaching</h4>
                        <div class="task-list" id="modalMorningTasks"></div>
                    </div>
                    
                    <!-- Self Study Schedule -->
                    <div>
                        <h4>Self Study</h4>
                        <div class="task-list" id="modalSelfStudyTasks"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal-overlay hidden">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>Task History</h3>
                <button onclick="closeHistoryModal()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="history-table">
                    <table>
                        <thead id="modalHistoryTableHead"></thead>
                        <tbody id="modalHistoryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let chapters = {};
        let dailyTasks = {};
        let currentTask = '';
        let activeTab = 'Physics';
        let expandedNotes = {};
        let syncStatus = 'idle';
        let githubToken = localStorage.getItem('github-token') || '';
        let gistId = localStorage.getItem('gist-id') || '';
        let lastSync = localStorage.getItem('last-sync') || '';

        // Initial chapters data
        const initialChapters = {
            Physics: {
                '1st Paper': [
                    { id: 'phy1-1', title: 'Physical World & Measurement', done: false, note: '' },
                    { id: 'phy1-2', title: 'Vectors', done: false, note: '' },
                    { id: 'phy1-3', title: 'Dynamics', done: false, note: '' },
                    { id: 'phy1-4', title: 'Work, Energy & Power', done: false, note: '' },
                    { id: 'phy1-5', title: 'Gravitation & Gravity', done: false, note: '' },
                ],
                '2nd Paper': [
                    { id: 'phy2-1', title: 'Thermodynamics', done: false, note: '' },
                    { id: 'phy2-2', title: 'Vibration & Waves', done: false, note: '' },
                    { id: 'phy2-3', title: 'Electric Fields & Potential', done: false, note: '' },
                    { id: 'phy2-4', title: 'Electric Current in Conductors', done: false, note: '' },
                    { id: 'phy2-5', title: 'Magnetic Fields', done: false, note: '' },
                    { id: 'phy2-6', title: 'Electromagnetic Induction', done: false, note: '' },
                    { id: 'phy2-7', title: 'Alternating Current', done: false, note: '' },
                    { id: 'phy2-8', title: 'Electromagnetic Waves', done: false, note: '' },
                    { id: 'phy2-9', title: 'Physical Optics', done: false, note: '' },
                    { id: 'phy2-10', title: 'Modern Physics', done: false, note: '' },
                ]
            },
            Chemistry: {
                '1st Paper': [
                    { id: 'chem1-1', title: 'Qualitative Chemistry', done: false, note: '' },
                    { id: 'chem1-2', title: 'Atomic Structure', done: false, note: '' },
                    { id: 'chem1-3', title: 'Periodic Table & Chemical Bonding', done: false, note: '' },
                    { id: 'chem1-4', title: 'Chemical Changes', done: false, note: '' },
                    { id: 'chem1-5', title: 'Working with Chemistry', done: false, note: '' },
                ],
                '2nd Paper': [
                    { id: 'chem2-1', title: 'Environmental Chemistry', done: false, note: '' },
                    { id: 'chem2-2', title: 'Organic Chemistry', done: false, note: '' },
                    { id: 'chem2-3', title: 'Quantitative Chemistry', done: false, note: '' },
                    { id: 'chem2-4', title: 'Chemical Kinetics & Chemical Equilibrium', done: false, note: '' },
                ]
            },
            'Higher Mathematics': {
                '1st Paper': [
                    { id: 'math1-1', title: 'Matrix & Determinant', done: false, note: '' },
                    { id: 'math1-2', title: 'Vectors', done: false, note: '' },
                    { id: 'math1-3', title: 'The Straight Line', done: false, note: '' },
                    { id: 'math1-4', title: 'Circles', done: false, note: '' },
                    { id: 'math1-5', title: 'Miscellaneous (Parabola, Ellipse, Hyperbola)', done: false, note: '' },
                ],
                '2nd Paper': [
                    { id: 'math2-1', title: 'Limits & Continuity', done: false, note: '' },
                    { id: 'math2-2', title: 'Differentiation', done: false, note: '' },
                    { id: 'math2-3', title: 'Integration', done: false, note: '' },
                    { id: 'math2-4', title: 'Differential Equations', done: false, note: '' },
                ]
            },
            Biology: {
                '1st Paper': [
                    { id: 'bio1-1', title: 'Cell & Its Structure', done: false, note: '' },
                    { id: 'bio1-2', title: 'Cell Division', done: false, note: '' },
                    { id: 'bio1-3', title: 'Cell Chemistry', done: false, note: '' },
                    { id: 'bio1-4', title: 'Bioenergetics (Photosynthesis & Respiration)', done: false, note: '' },
                    { id: 'bio1-5', title: 'Growth & Development', done: false, note: '' },
                    { id: 'bio1-6', title: 'Reproduction', done: false, note: '' },
                    { id: 'bio1-7', title: 'Genetics & Heredity', done: false, note: '' },
                    { id: 'bio1-8', title: 'Evolution & Classification', done: false, note: '' },
                    { id: 'bio1-9', title: 'Diversity of Microorganisms', done: false, note: '' },
                    { id: 'bio1-10', title: 'Plant Anatomy', done: false, note: '' },
                    { id: 'bio1-11', title: 'Biome & Biodiversity', done: false, note: '' },
                ],
                '2nd Paper': [
                    { id: 'bio2-1', title: 'Animal Diversity', done: false, note: '' },
                    { id: 'bio2-2', title: 'Structural Organization in Animals', done: false, note: '' },
                    { id: 'bio2-3', title: 'Human Physiology', done: false, note: '' },
                    { id: 'bio2-4', title: 'Human Health & Disease', done: false, note: '' },
                    { id: 'bio2-5', title: 'Applied Biology (Biotechnology)', done: false, note: '' },
                ]
            }
        };

        // Date constants
        const startDate = new Date('2025-09-15');
        const endDate = new Date('2026-09-30');

        // Load saved data
        function loadData() {
            const savedChapters = localStorage.getItem('hsc-study-tracker-v2');
            chapters = savedChapters ? JSON.parse(savedChapters) : initialChapters;
            
            const savedDailyTasks = localStorage.getItem('daily-tasks');
            dailyTasks = savedDailyTasks ? JSON.parse(savedDailyTasks) : {};
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('hsc-study-tracker-v2', JSON.stringify(chapters));
            localStorage.setItem('daily-tasks', JSON.stringify(dailyTasks));
        }

        // Calculate time progress
        function calculateTimeProgress() {
            const now = new Date();
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            const daysPassed = Math.max(0, Math.ceil((now - startDate) / (1000 * 60 * 60 * 24)));
            const percentage = Math.min(100, Math.max(0, (daysPassed / totalDays) * 100));
            
            return {
                percentage: Math.round(percentage),
                daysPassed: Math.min(daysPassed, totalDays),
                totalDays
            };
        }

        // Calculate syllabus progress
        function calculateSyllabusProgress() {
            let totalChapters = 0;
            let completedChapters = 0;
            
            Object.values(chapters).forEach(subject => {
                Object.values(subject).forEach(paperChapters => {
                    totalChapters += paperChapters.length;
                    completedChapters += paperChapters.filter(ch => ch.done).length;
                });
            });
            
            const percentage = totalChapters > 0 ? Math.round((completedChapters / totalChapters) * 100) : 0;
            
            return {
                percentage,
                completedChapters,
                totalChapters
            };
        }

        // Get day schedule
        function getDaySchedule(date = new Date()) {
            const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            const dateStr = date.toISOString().split('T')[0];
            
            // Get rotation index for subjects (cycles every 6 days)
            const daysSinceStart = Math.floor((date - new Date('2025-09-15')) / (1000 * 60 * 60 * 24));
            const rotationIndex = daysSinceStart % 6;
            const rotationSubjects = ['Physics', 'Chemistry', 'Math', 'Biology', 'ICT', 'English'];
            const rotationSubject = rotationSubjects[rotationIndex];

            const baseSchedule = {
                morning: [],
                selfStudy: [],
                dateStr,
                rotationSubject
            };

            if (dayOfWeek === 5) { // Friday
                baseSchedule.selfStudy = [
                    { id: 'chem-study', name: 'Chemistry Study', time: '6:30-7:30 PM' },
                    { id: 'math-study', name: 'Math Study', time: '7:30-8:30 PM' },
                    { id: 'revision-combined', name: 'Revision (Mixed)', time: '8:30-9:00 PM' },
                    { id: 'bio-ict-study', name: 'Biology/ICT Study', time: '9:00-9:30 PM' },
                    { id: 'dinner', name: 'Dinner', time: '9:30-10:00 PM' },
                    { id: 'eng-study', name: 'English Study', time: '10:00-10:30 PM' },
                    { id: 'revision-mixed', name: 'Revision (Mixed)', time: '10:30-11:00 PM' }
                ];
            } else if ([0, 2, 4].includes(dayOfWeek)) { // Sun, Tue, Thu
                baseSchedule.morning = [
                    { id: 'chem-jahangir', name: 'Chemistry (Jahangir Sir)', time: '7:30-8:30 AM' },
                    { id: 'college', name: 'College', time: '9:00-12:00 PM' },
                    { id: 'online-chem', name: 'Online Chemistry', time: '2:00-3:30 PM' },
                    { id: 'physics-ashraf', name: 'Physics (Ashraf Sir)', time: '4:00-6:00 PM' }
                ];
                baseSchedule.selfStudy = [
                    { id: 'chem-study', name: 'Chemistry Study', time: '6:30-7:30 PM' },
                    { id: 'math-study', name: 'Math Study', time: '7:30-8:30 PM' },
                    { id: 'algorithm', name: `Algorithm (Physics/Chemistry)`, time: '8:30-9:00 PM' },
                    { id: 'bio-ict-study', name: 'Biology/ICT Study', time: '9:00-9:30 PM' },
                    { id: 'dinner', name: 'Dinner', time: '9:30-10:00 PM' },
                    { id: 'eng-bangla-study', name: 'English/Bangla Study', time: '10:00-10:30 PM' },
                    { id: 'questions', name: `Questions (${rotationSubject})`, time: '10:30-11:00 PM' }
                ];
            } else if ([6, 1, 3].includes(dayOfWeek)) { // Sat, Mon, Wed
                baseSchedule.morning = [
                    { id: 'chem-jahangir', name: 'Chemistry (Jahangir Sir)', time: '7:30-8:30 AM' },
                    { id: 'college', name: 'College', time: '9:00-12:00 PM' },
                    { id: 'math-hanifa', name: 'Math (Hanifa Sir)', time: '2:20-3:30 PM' },
                    { id: 'bio-santo', name: 'Biology (Santo Sir)', time: '4:00-5:00 PM' },
                    { id: 'eng-ranju', name: 'English (Ranju Sir)', time: '5:00-6:00 PM' }
                ];
                baseSchedule.selfStudy = [
                    { id: 'chem-study', name: 'Chemistry Study', time: '6:30-7:30 PM' },
                    { id: 'math-study', name: 'Math Study', time: '7:30-8:30 PM' },
                    { id: 'algorithm', name: `Algorithm (Physics/Math)`, time: '8:30-9:00 PM' },
                    { id: 'bio-ict-study', name: 'Biology/ICT Study', time: '9:00-9:30 PM' },
                    { id: 'dinner', name: 'Dinner', time: '9:30-10:00 PM' },
                    { id: 'eng-bangla-study', name: 'English/Bangla Study', time: '10:00-10:30 PM' },
                    { id: 'questions', name: `Questions (${rotationSubject})`, time: '10:30-11:00 PM' }
                ];
            }

            return baseSchedule;
        }

        function parseTime(timeStr) {
            const [time, period] = timeStr.trim().split(' ');
            const [hours, minutes] = time.split(':').map(Number);
            let hour24 = hours;
            if (period === 'PM' && hours !== 12) hour24 += 12;
            if (period === 'AM' && hours === 12) hour24 = 0;
            return hour24 * 60 + (minutes || 0);
        }

        function getSortedTasks(date = new Date()) {
            const schedule = getDaySchedule(date);
            const allTasks = [...schedule.morning, ...schedule.selfStudy];
            allTasks.sort((a, b) => parseTime(a.time.split('-')[0]) - parseTime(b.time.split('-')[0]));
            return allTasks;
        }

        // Get hero tasks (prev, current, next)
        function getHeroTasks() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const dateStr = now.toISOString().split('T')[0];
            const sortedTasks = getSortedTasks(now);
            let prev = null, current = null, next = null;

            for (let i = 0; i < sortedTasks.length; i++) {
                const task = sortedTasks[i];
                const [startStr, endStr] = task.time.split('-');
                const start = parseTime(startStr);
                const end = parseTime(endStr);

                if (currentTime >= start && currentTime < end) {
                    current = { ...task, dateStr };
                    if (i > 0) prev = { ...sortedTasks[i-1], dateStr };
                    if (i < sortedTasks.length - 1) next = { ...sortedTasks[i+1], dateStr };
                    return { prev, current, next };
                } else if (currentTime < start && !current) {
                    current = { name: 'Free time', id: null, dateStr: null };
                    next = { ...sortedTasks[0], dateStr };
                    return { prev, current, next };
                }
            }

            // After last task
            if (!current) {
                current = { name: 'Free time', id: null, dateStr: null };
                prev = sortedTasks.length > 0 ? { ...sortedTasks[sortedTasks.length - 1], dateStr } : null;
            }

            return { prev, current, next };
        }

        // Toggle daily task completion
        function toggleDailyTask(dateStr, taskId) {
            if (!dateStr || !taskId) return;
            if (!dailyTasks[dateStr]) {
                dailyTasks[dateStr] = {};
            }
            dailyTasks[dateStr][taskId] = !dailyTasks[dateStr][taskId];
            saveData();
            updateHeroTasks();
        }

        // Get task completion status
        function getTaskCompletion(dateStr, taskId) {
            return dailyTasks[dateStr]?.[taskId] || false;
        }

        // Update progress displays
        function updateProgress() {
            const syllabusProgress = calculateSyllabusProgress();

            // Syllabus progress
            document.getElementById('syllabusPercentage').textContent = `${syllabusProgress.percentage}%`;
            document.getElementById('syllabusProgressBar').style.width = `${syllabusProgress.percentage}%`;
            document.getElementById('syllabusStats').textContent = `${syllabusProgress.completedChapters} / ${syllabusProgress.totalChapters} chapters`;
        }

        // Update hero tasks display
        function updateHeroTasks() {
            const { prev, current, next } = getHeroTasks();
            let html = '';

            if (prev) {
                const isCompleted = getTaskCompletion(prev.dateStr, prev.id);
                html += `
                    <div class="task-card small">
                        <div class="task-label">Previous</div>
                        <div class="task-name ${isCompleted ? 'completed' : ''}">${prev.name}</div>
                        <div class="task-tick ${isCompleted ? 'completed' : ''}" onclick="toggleDailyTask('${prev.dateStr}', '${prev.id}')">
                            ${isCompleted ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                        </div>
                    </div>
                `;
            }

            // Current task
            html += `
                <div class="task-card">
                    <div class="task-label">Now</div>
                    <div class="task-name">${current.name}</div>
            `;
            if (current.id && current.dateStr) {
                const isCompleted = getTaskCompletion(current.dateStr, current.id);
                html += `
                    <div class="task-tick ${isCompleted ? 'completed' : ''}" onclick="toggleDailyTask('${current.dateStr}', '${current.id}')">
                        ${isCompleted ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                    </div>
                `;
            }
            html += `</div>`;

            if (next) {
                const isCompleted = getTaskCompletion(next.dateStr, next.id);
                html += `
                    <div class="task-card small">
                        <div class="task-label">Next</div>
                        <div class="task-name ${isCompleted ? 'completed' : ''}">${next.name}</div>
                        <div class="task-tick ${isCompleted ? 'completed' : ''}" onclick="toggleDailyTask('${next.dateStr}', '${next.id}')">
                            ${isCompleted ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                        </div>
                    </div>
                `;
            }

            document.getElementById('heroTasks').innerHTML = html;
        }

        // Update schedule modal
        function updateScheduleModal() {
            const schedule = getDaySchedule();
            
            // Morning tasks
            const morningContainer = document.getElementById('modalMorningTasks');
            const morningScheduleDiv = document.getElementById('modalMorningSchedule');
            
            if (schedule.morning.length > 0) {
                morningScheduleDiv.style.display = 'block';
                morningContainer.innerHTML = schedule.morning.map(task => {
                    const isCompleted = getTaskCompletion(schedule.dateStr, task.id);
                    return `
                        <div class="task-item">
                            <div class="task-checkbox ${isCompleted ? 'completed' : ''}" onclick="toggleDailyTask('${schedule.dateStr}', '${task.id}')">
                                ${isCompleted ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                            </div>
                            <div class="task-content">
                                <div class="task-name ${isCompleted ? 'completed' : ''}">${task.name}</div>
                                <div class="task-time">${task.time}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                morningScheduleDiv.style.display = 'none';
            }

            // Self study tasks
            const selfStudyContainer = document.getElementById('modalSelfStudyTasks');
            selfStudyContainer.innerHTML = schedule.selfStudy.map(task => {
                const isCompleted = getTaskCompletion(schedule.dateStr, task.id);
                return `
                    <div class="task-item">
                        <div class="task-checkbox ${isCompleted ? 'completed' : ''}" onclick="toggleDailyTask('${schedule.dateStr}', '${task.id}')">
                            ${isCompleted ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                        </div>
                        <div class="task-content">
                            <div class="task-name ${isCompleted ? 'completed' : ''}">${task.name}</div>
                            <div class="task-time">${task.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update history modal
        function updateHistoryModal() {
            const last7Days = Array.from({ length: 7 }, (_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - (6 - i));
                return date;
            });

            // Get all unique tasks from a sample day
            const sampleSchedule = getDaySchedule(new Date());
            const allTasks = [...sampleSchedule.morning, ...sampleSchedule.selfStudy];

            // Create table header
            const tableHead = document.getElementById('modalHistoryTableHead');
            tableHead.innerHTML = `
                <tr>
                    <th>Date</th>
                    ${allTasks.map(task => `<th>${task.name.split(' (')[0]}</th>`).join('')}
                </tr>
            `;

            // Create table body
            const tableBody = document.getElementById('modalHistoryTableBody');
            tableBody.innerHTML = last7Days.map(date => {
                const dateStr = date.toISOString().split('T')[0];
                const schedule = getDaySchedule(date);
                const dayTasks = [...schedule.morning, ...schedule.selfStudy];
                
                return `
                    <tr>
                        <td style="font-weight: 500;">${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</td>
                        ${allTasks.map(task => {
                            const dayTask = dayTasks.find(dt => dt.id === task.id);
                            const isCompleted = dayTask ? getTaskCompletion(dateStr, task.id) : false;
                            return `<td><i class="ri-${isCompleted ? 'check' : 'close'}-line history-icon ${isCompleted ? 'completed' : 'incomplete'}"></i></td>`;
                        }).join('')}
                    </tr>
                `;
            }).join('');
        }

        // Modal open/close functions
        function openScheduleModal() {
            updateScheduleModal();
            document.getElementById('scheduleModal').classList.remove('hidden');
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.add('hidden');
        }

        function openHistoryModal() {
            updateHistoryModal();
            document.getElementById('historyModal').classList.remove('hidden');
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.add('hidden');
        }

        function openSettings() {
            document.getElementById('githubToken').value = githubToken;
            document.getElementById('gistId').value = gistId;
            updateSyncButtons();
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            githubToken = document.getElementById('githubToken').value;
            gistId = document.getElementById('gistId').value;
            if (githubToken) localStorage.setItem('github-token', githubToken);
            if (gistId) localStorage.setItem('gist-id', gistId);
            updateSyncStatus();
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function openSyllabusEditor() {
            renderSubjectTabs();
            renderChapters();
            updateSyncButton();
            document.getElementById('syllabusModal').classList.remove('hidden');
        }

        function closeSyllabusEditor() {
            document.getElementById('syllabusModal').classList.add('hidden');
        }

        function toggleHelp() {
            document.getElementById('helpSection').classList.toggle('hidden');
        }

        // Syllabus editor functions
        function renderSubjectTabs() {
            const tabsContainer = document.getElementById('subjectTabs');
            tabsContainer.innerHTML = Object.keys(chapters).map(subject => 
                `<button class="tab-button ${subject === activeTab ? 'active' : ''}" onclick="switchTab('${subject}')">${subject}</button>`
            ).join('');
        }

        function switchTab(subject) {
            activeTab = subject;
            renderSubjectTabs();
            renderChapters();
        }

        function renderChapters() {
            const chaptersGrid = document.getElementById('chaptersGrid');
            chaptersGrid.innerHTML = Object.entries(chapters[activeTab]).map(([paper, paperChapters]) => `
                <div class="paper-section">
                    <h3 class="paper-title">${paper}</h3>
                    <div class="chapter-list">
                        ${paperChapters.map(chapter => `
                            <div class="chapter-item">
                                <div class="chapter-checkbox ${chapter.done ? 'completed' : ''}" onclick="toggleChapter('${activeTab}', '${paper}', '${chapter.id}')">
                                    ${chapter.done ? '<i class="ri-check-line animate-scale-in"></i>' : ''}
                                </div>
                                <span class="chapter-title ${chapter.done ? 'completed' : ''}">${chapter.title}</span>
                                <div class="chapter-note-btn" onclick="toggleNote('${chapter.id}')">
                                    <i class="ri-file-text-line"></i>
                                </div>
                            </div>
                            <div id="note-${chapter.id}" class="chapter-note ${expandedNotes[chapter.id] ? '' : 'hidden'}">
                                <textarea placeholder="Add a note..." oninput="updateNote('${activeTab}', '${paper}', '${chapter.id}', this.value)">${chapter.note}</textarea>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function toggleChapter(subject, paper, chapterId) {
            chapters[subject][paper] = chapters[subject][paper].map(ch => 
                ch.id === chapterId ? { ...ch, done: !ch.done } : ch
            );
            saveData();
            updateProgress();
            renderChapters();
        }

        function toggleNote(chapterId) {
            expandedNotes[chapterId] = !expandedNotes[chapterId];
            document.getElementById(`note-${chapterId}`).classList.toggle('hidden');
        }

        function updateNote(subject, paper, chapterId, note) {
            chapters[subject][paper] = chapters[subject][paper].map(ch => 
                ch.id === chapterId ? { ...ch, note } : ch
            );
            saveData();
        }

        // Cloud sync functions
        function updateSyncStatus() {
            const syncIcon = document.getElementById('syncIcon');
            const syncText = document.getElementById('syncText');
            
            if (syncStatus === 'syncing') {
                syncIcon.className = 'ri-cloud-line animate-pulse';
                syncText.textContent = 'Syncing...';
            } else if (syncStatus === 'success') {
                syncIcon.className = 'ri-cloud-line text-green-600';
                syncText.textContent = 'Synced';
            } else if (syncStatus === 'error') {
                syncIcon.className = 'ri-cloud-off-line text-red-600';
                syncText.textContent = 'Sync failed';
            } else {
                if (githubToken && gistId) {
                    syncIcon.className = 'ri-cloud-line text-blue-600';
                    syncText.textContent = lastSync ? `Last sync: ${lastSync}` : 'Ready to sync';
                } else {
                    syncIcon.className = 'ri-cloud-line text-gray-400';
                    syncText.textContent = 'Offline mode';
                }
            }
        }

        function updateSyncButtons() {
            const syncFromBtn = document.getElementById('syncFromCloudBtn');
            const syncToBtn = document.getElementById('syncToCloudBtn');
            
            if (gistId) {
                syncFromBtn.textContent = 'Sync From Cloud';
                syncToBtn.style.display = 'block';
            } else {
                syncFromBtn.textContent = 'Create New Gist';
                syncToBtn.style.display = 'none';
            }
        }

        function updateSyncButton() {
            const syncButton = document.getElementById('syncButton');
            if (githubToken && gistId) {
                syncButton.style.display = 'block';
            } else {
                syncButton.style.display = 'none';
            }
        }

        async function syncToCloud() {
            if (!githubToken || !gistId) return;
            
            syncStatus = 'syncing';
            updateSyncStatus();
            
            try {
                const data = {
                    chapters,
                    dailyTasks,
                    lastUpdated: new Date().toISOString(),
                    device: navigator.userAgent.includes('Mobile') ? 'mobile' : 'desktop'
                };

                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        files: {
                            'hsc-study-tracker.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });

                if (response.ok) {
                    syncStatus = 'success';
                    const syncTime = new Date().toLocaleString();
                    lastSync = syncTime;
                    localStorage.setItem('last-sync', syncTime);
                    setTimeout(() => {
                        syncStatus = 'idle';
                        updateSyncStatus();
                    }, 2000);
                } else {
                    throw new Error('Sync failed');
                }
            } catch (error) {
                syncStatus = 'error';
                setTimeout(() => {
                    syncStatus = 'idle';
                    updateSyncStatus();
                }, 3000);
            }
            
            updateSyncStatus();
        }

        async function syncFromCloud() {
            if (!githubToken) return;
            
            syncStatus = 'syncing';
            updateSyncStatus();
            
            try {
                if (gistId) {
                    // Sync from existing gist
                    const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        headers: {
                            'Authorization': `token ${githubToken}`,
                        }
                    });

                    if (response.ok) {
                        const gist = await response.json();
                        const fileContent = gist.files['hsc-study-tracker.json']?.content;
                        
                        if (fileContent) {
                            const data = JSON.parse(fileContent);
                            chapters = data.chapters;
                            if (data.dailyTasks) dailyTasks = data.dailyTasks;
                            saveData();
                            updateProgress();
                            updateHeroTasks();
                            syncStatus = 'success';
                            const syncTime = new Date().toLocaleString();
                            lastSync = syncTime;
                            localStorage.setItem('last-sync', syncTime);
                        }
                    } else {
                        throw new Error('Download failed');
                    }
                } else {
                    // Create new gist
                    const data = {
                        chapters,
                        dailyTasks,
                        lastUpdated: new Date().toISOString(),
                        device: 'initial'
                    };

                    const response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            description: 'HSC Study Tracker Progress',
                            public: false,
                            files: {
                                'hsc-study-tracker.json': {
                                    content: JSON.stringify(data, null, 2)
                                }
                            }
                        })
                    });

                    if (response.ok) {
                        const gist = await response.json();
                        gistId = gist.id;
                        localStorage.setItem('gist-id', gistId);
                        document.getElementById('gistId').value = gistId;
                        updateSyncButtons();
                        syncStatus = 'success';
                    } else {
                        throw new Error('Failed to create gist');
                    }
                }
                
                setTimeout(() => {
                    syncStatus = 'idle';
                    updateSyncStatus();
                }, 2000);
            } catch (error) {
                syncStatus = 'error';
                setTimeout(() => {
                    syncStatus = 'idle';
                    updateSyncStatus();
                }, 3000);
            }
            
            updateSyncStatus();
        }

        // Export functions
        function exportData(format) {
            const flatChapters = [];
            Object.entries(chapters).forEach(([subject, papers]) => {
                Object.entries(papers).forEach(([paper, paperChapters]) => {
                    paperChapters.forEach(ch => {
                        flatChapters.push({
                            ...ch,
                            subject,
                            paper
                        });
                    });
                });
            });

            const timeProgress = calculateTimeProgress();
            const syllabusProgress = calculateSyllabusProgress();

            const data = {
                exported: new Date().toISOString(),
                timeProgress,
                syllabusProgress,
                chapters: flatChapters,
                dailyTasks
            };
            
            if (format === 'json') {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hsc-study-progress.json';
                a.click();
                URL.revokeObjectURL(url);
            } else if (format === 'csv') {
                const csvContent = [
                    'Subject,Paper,Chapter,Completed,Note',
                    ...flatChapters.map(ch => 
                        `"${ch.subject}","${ch.paper}","${ch.title}",${ch.done ? 'Yes' : 'No'},"${ch.note}"`
                    )
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hsc-study-progress.csv';
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        // Reset function
        function resetChapters() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                chapters = JSON.parse(JSON.stringify(initialChapters));
                dailyTasks = {};
                expandedNotes = {};
                saveData();
                updateProgress();
                updateHeroTasks();
                renderChapters();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'r') {
                    e.preventDefault();
                    resetChapters();
                } else if (e.key === 'e') {
                    e.preventDefault();
                    exportData('csv');
                } else if (e.key === 's') {
                    e.preventDefault();
                    syncToCloud();
                }
            }
            if (e.key === 'Escape') {
                if (!document.getElementById('settingsModal').classList.contains('hidden')) {
                    closeSettings();
                } else if (!document.getElementById('syllabusModal').classList.contains('hidden')) {
                    closeSyllabusEditor();
                } else if (!document.getElementById('scheduleModal').classList.contains('hidden')) {
                    closeScheduleModal();
                } else if (!document.getElementById('historyModal').classList.contains('hidden')) {
                    closeHistoryModal();
                }
            }
        });

        // Initialize app
        function init() {
            loadData();
            updateProgress();
            updateHeroTasks();
            updateSyncStatus();

            // Update hero tasks every minute
            setInterval(updateHeroTasks, 60000);
        }

        // Start the app
        init();
    </script>
</body>
</html>